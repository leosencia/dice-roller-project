<!DOCTYPE html>
<html>
    <head>
        <!--Vertex Shader-->
        <script type="x-shader/x-vertex" id="vshader">
            attribute vec4 aPosition;
            attribute vec2 aTexCoord;
            
            uniform mat4 uModelMatrix;
            uniform mat4 uViewMatrix;
            uniform mat4 uProjectionMatrix;
            
            varying vec2 vTexCoord;

            void main() {
                gl_Position = uProjectionMatrix * uViewMatrix * uModelMatrix * aPosition;
                vTexCoord = aTexCoord;
            }
        </script>

        <!--Fragment Shader-->
        <script type="x-shader/x-fragment" id="fshader">
            precision mediump float;

            uniform vec4 u_color;
            varying vec2 vTexCoord;
            uniform sampler2D uSampler;

            uniform bool uUseTexture;

            void main(void) {
                if (uUseTexture) {
                    gl_FragColor = texture2D(uSampler, vTexCoord);
                } else {
                    gl_FragColor = u_color;
                }
            }
        </script>

        <!--Import external javascript file-->
        <!--Helper javascript methods for initializing webgl-->
        <script src="./lib/webgl-init.js"></script>
        <script src="./lib/webgl-utils.js"></script>
        <script src="./lib/webgl-debug.js"></script>
        <script src="./lib/gl-matrix-min.js"></script>

        <script>
            function main() {
                // Retrieve <canvas> element
                var canvas = document.getElementById("main_canvas");
                if (!canvas) {
                    console.log("Failed to retrieve the <canvas> element");
                }
                // Rendering Context
                var gl = initializeWebGL(canvas,true);
                // Initialize Shaders Program
                var vertexShader = initializeShader(gl, "vshader");
                var fragmentShader = initializeShader(gl, "fshader");
                var program = initializeProgram(gl, vertexShader, fragmentShader);
                gl.useProgram(program);

                var aPositionPointer = gl.getAttribLocation(program, "aPosition");
                var aTexCoordPointer = gl.getAttribLocation(program, "aTexCoord")
                gl.enableVertexAttribArray(aPositionPointer);
                gl.enableVertexAttribArray(aTexCoordPointer);

                var colorLocation = gl.getUniformLocation(program, "u_color");

                
                var uModelMatrixPointer = gl.getUniformLocation(program, "uModelMatrix");
                var uViewMatrixPointer = gl.getUniformLocation(program, "uViewMatrix");
                var uProjectionMatrixPointer = gl.getUniformLocation(program, "uProjectionMatrix");

                var modelMatrix;
                var viewMatrix;
                var projectionMatrix;

                // Projection Matrix Specification
                var fieldOfViewYAxis = glMatrix.toRadian(30);
                var aspectRatio      = canvas.width/canvas.height;
                var nearPlane        = 1;
                var farPlane         = 100;

                projectionMatrix = mat4.create();
                mat4.perspective(projectionMatrix,fieldOfViewYAxis,aspectRatio,nearPlane,farPlane);
                gl.uniformMatrix4fv(uProjectionMatrixPointer,false,new Float32Array(projectionMatrix));

                // View Matrix Specification
                var lookAtPoint = [0.0,0.0,0.0,1.0];              //where the camera is looking
                var eyePoint    = [1.0,2.0,3.0,1.0];              //where the camera is placed
                var upVector    = [0.0,1.0,0.0,0.0];              //orientation of the camera

                viewMatrix = mat4.create();
                mat4.lookAt(viewMatrix,eyePoint,lookAtPoint,upVector);
                gl.uniformMatrix4fv(uViewMatrixPointer,false,new Float32Array(viewMatrix));

                // Model Matrix
                modelMatrix = mat4.create();
                modelMatrix = mat4.identity(modelMatrix);
                gl.uniformMatrix4fv(uModelMatrixPointer,false,new Float32Array(modelMatrix));

                //D4 Dice
                var diceFour = [
                    0.25, 0.25, 0.25, 1.0,
                    -0.25, -0.25, 0.25, 1.0,
                    -0.25, 0.25, -0.25, 1.0,
                    0.25, -0.25, -0.25, 1.0
                ];

                // D6 Dice
                var diceSix = [
                    // Front face
                    -0.25, -0.25,  0.25, 1.0,
                    0.25, -0.25,  0.25, 1.0,
                    0.25,  0.25,  0.25, 1.0,
                    -0.25,  0.25,  0.25, 1.0,
                    // Back face
                    -0.25, -0.25, -0.25, 1.0,
                    -0.25,  0.25, -0.25, 1.0,
                    0.25,  0.25, -0.25, 1.0,
                    0.25, -0.25, -0.25, 1.0,
                    // Top face
                    -0.25,  0.25, -0.25, 1.0,
                    -0.25,  0.25,  0.25, 1.0,
                    0.25,  0.25,  0.25, 1.0,
                    0.25,  0.25, -0.25, 1.0,
                    // Bottom face
                    -0.25, -0.25, -0.25, 1.0,
                    0.25, -0.25, -0.25, 1.0,
                    0.25, -0.25,  0.25, 1.0,
                    -0.25, -0.25,  0.25, 1.0,
                    // Right face
                    0.25, -0.25, -0.25, 1.0,
                    0.25,  0.25, -0.25, 1.0,
                    0.25,  0.25,  0.25, 1.0,
                    0.25, -0.25,  0.25, 1.0,
                    // Left face
                    -0.25, -0.25, -0.25, 1.0,
                    -0.25, -0.25,  0.25, 1.0,
                    -0.25,  0.25,  0.25, 1.0,
                    -0.25,  0.25, -0.25, 1.0
                ];

                // D8 Dice
                var diceEight = [
                    0.0, 0.0, 0.25, 1.0,
                    0.0, 0.0, -0.25, 1.0,
                    0.25, 0.0, 0.0, 1.0,
                    -0.25, 0.0, 0.0, 1.0,
                    0.0, 0.25, 0.0, 1.0,
                    0.0, -0.25, 0.0, 1.0
                ];

                // D12 Dice
                // Reference: https://github.com/mrdoob/three.js/blob/master/src/geometries/DodecahedronGeometry.js
                const t = (1 + Math.sqrt(5)) / 2;
                const r = 1 / t;
                var diceTwelve = [
                    // (±1, ±1, ±1)
                    - 1, - 1, - 1,	- 1, - 1, 1,
                    - 1, 1, - 1, - 1, 1, 1,
                    1, - 1, - 1, 1, - 1, 1,
                    1, 1, - 1, 1, 1, 1,

                    // (0, ±1/φ, ±φ)
                    0, - r, - t, 0, - r, t,
                    0, r, - t, 0, r, t,

                    // (±1/φ, ±φ, 0)
                    - r, - t, 0, - r, t, 0,
                    r, - t, 0, r, t, 0,

                    // (±φ, 0, ±1/φ)
                    - t, 0, - r, t, 0, - r,
                    - t, 0, r, t, 0, r
                ]

                // Scale factor to see the shape better
                var rad = 0.25;
                    for (let i = 0; i < diceTwelve.length; i++) {
                    diceTwelve[i] *= rad;
                }

                // Buffer Creation
                gl.enableVertexAttribArray(aPositionPointer);

                var diceFourBuffer = gl.createBuffer();
                gl.bindBuffer(gl.ARRAY_BUFFER, diceFourBuffer);
                gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(diceFour), gl.STATIC_DRAW);
                gl.vertexAttribPointer(aPositionPointer, 4, gl.FLOAT, false, 0, 0);
                
                var diceSixBuffer = gl.createBuffer();
                gl.bindBuffer(gl.ARRAY_BUFFER, diceSixBuffer);
                gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(diceSix), gl.STATIC_DRAW);
                gl.vertexAttribPointer(aPositionPointer, 4, gl.FLOAT, false, 0, 0);

                var diceEightBuffer = gl.createBuffer();
                gl.bindBuffer(gl.ARRAY_BUFFER, diceEightBuffer);
                gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(diceEight), gl.STATIC_DRAW);
                gl.vertexAttribPointer(aPositionPointer, 4, gl.FLOAT, false, 0, 0);

                var diceTwelveBuffer = gl.createBuffer();
                gl.bindBuffer(gl.ARRAY_BUFFER, diceTwelveBuffer);
                gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(diceTwelve), gl.STATIC_DRAW);
                gl.vertexAttribPointer(aPositionPointer, 3, gl.FLOAT, false, 0, 0);
                


                // Index Array for D4
                var diceFourIndices = [
                    0, 1, 2,
                    0, 1, 3,
                    0, 2, 3,
                    1, 2, 3
                ];

                // Index Array for D6
                var diceSixIndices = [
                    0, 1, 2,      0, 2, 3,    // Front face
                    4, 5, 6,      4, 6, 7,    // Back face
                    8, 9, 10,     8, 10, 11,  // Top face
                    12, 13, 14,   12, 14, 15, // Bottom face
                    16, 17, 18,   16, 18, 19, // Right face
                    20, 21, 22,   20, 22, 23  // Left face
                ];

                // Index Array for D8
                var diceEightIndices = [
                    0, 2, 4,   // Top Side
                    0, 4, 3,
                    0, 3, 5,
                    0, 5, 2,
                    1, 2, 4,   // Bottom Side
                    1, 3, 4,
                    1, 3, 5,
                    1, 2, 5
                ];

                // Index Array for D12
                var diceTwelveIndices = [
                    3, 11, 7, 	3, 7, 15, 	3, 15, 13,
                    7, 19, 17, 	7, 17, 6, 	7, 6, 15,
                    17, 4, 8, 	17, 8, 10, 	17, 10, 6,
                    8, 0, 16, 	8, 16, 2, 	8, 2, 10,
                    0, 12, 1, 	0, 1, 18, 	0, 18, 16,
                    6, 10, 2, 	6, 2, 13, 	6, 13, 15,
                    2, 16, 18, 	2, 18, 3, 	2, 3, 13,
                    18, 1, 9, 	18, 9, 11, 	18, 11, 3,
                    4, 14, 12, 	4, 12, 0, 	4, 0, 8,
                    11, 9, 5, 	11, 5, 19, 	11, 19, 7,
                    19, 5, 14, 	19, 14, 4, 	19, 4, 17,
                    1, 12, 14, 	1, 14, 5, 	1, 5, 9
                ]

                // D8 Number Texture
                var diceSixUVFace = [
                    0.0, 1.0,
                    1.0, 1.0,
                    0.0, 0.0,
                    1.0, 0.0,
                ]

                // Edge Outlines
                // D4 Edge Outlines
                var diceFourEdges = [
                    0, 1,
                    0, 2,
                    0, 3,
                    1, 2,
                    1, 3,
                    2, 3
                ]

                var diceFourEdgesBuffer = gl.createBuffer();
                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, diceFourEdgesBuffer);
                gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint8Array(diceFourEdges), gl.STATIC_DRAW);
                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);

                // D6 Edge Outlines
                var diceSixEdges = [
                    0, 1,
                    1, 2,
                    2, 3,
                    3, 0,

                    // Back face
                    4, 5,
                    5, 6,
                    6, 7,
                    7, 4,

                    // Top face
                    8, 9,
                    9,10,
                    10,11,
                    11,8,

                    // Bottom face
                    12,13,
                    13,14,
                    14,15,
                    15,12,

                    // Right face
                    16,17,
                    17,18,
                    18,19,
                    19,16,

                    // Left face
                    20,21,
                    21,22,
                    22,23,
                    23,20
                ];

                var diceSixEdgesBuffer = gl.createBuffer();
                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, diceSixEdgesBuffer);
                gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint8Array(diceSixEdges), gl.STATIC_DRAW);
                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);

                // D8 Edge Outlines
                var diceEightEdges = [
                    // Top
                    0, 2,
                    0, 4,
                    0, 3,
                    0, 5,
                    
                    // Side or Center
                    2, 4,
                    3, 4,
                    3, 5,
                    2, 5,

                    // Bottom
                    1, 2,
                    1, 4,
                    1, 3,
                    1, 5
                ];

                var diceEightEdgesBuffer = gl.createBuffer();
                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, diceEightEdgesBuffer);
                gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint8Array(diceEightEdges), gl.STATIC_DRAW);
                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);

                var diceTwelveEdges = [];
                for (let i = 0; i < diceTwelveIndices.length; i += 9) {
                    const indices = [
                        diceTwelveIndices[i], diceTwelveIndices[i+1], diceTwelveIndices[i+2],
                        diceTwelveIndices[i+3], diceTwelveIndices[i+4], diceTwelveIndices[i+5],
                        diceTwelveIndices[i+6], diceTwelveIndices[i+7], diceTwelveIndices[i+8],
                    ];

                    // Get unique indices (removing duplicates)
                    const uniqueIndices = [...new Set(indices)];

                    // Add line segments between consecutive points and wrap around
                    for (let j = 0; j < 5; j++) {
                        const a = uniqueIndices[j];
                        const b = uniqueIndices[(j + 1) % 5];
                        diceTwelveEdges.push(a, b);  // store as line segment
                    }
                }

                var diceTwelveEdgesBuffer = gl.createBuffer();
                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, diceTwelveEdgesBuffer);
                gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint8Array(diceTwelveEdges), gl.STATIC_DRAW);
                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);

                var diceFourIndicesBuffer = gl.createBuffer();
                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, diceFourIndicesBuffer);
                gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint8Array(diceFourIndices), gl.STATIC_DRAW);
                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);

                var diceSixIndicesBuffer = gl.createBuffer();
                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, diceSixIndicesBuffer);
                gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint8Array(diceSixIndices), gl.STATIC_DRAW);
                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);

                var diceEightIndicesBuffer = gl.createBuffer();
                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, diceEightIndicesBuffer);
                gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint8Array(diceEightIndices), gl.STATIC_DRAW);
                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);

                var diceTwelveIndicesBuffer = gl.createBuffer();
                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, diceTwelveIndicesBuffer);
                gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint8Array(diceTwelveIndices), gl.STATIC_DRAW);
                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);

                gl.clearColor(0.5,0.5,0.5,1.0);
                gl.clear(gl.COLOR_BUFFER_BIT);
                gl.enable(gl.DEPTH_TEST);
                
                let currentDice = "diceFour";

                // Texture Loader
                function textureLoader(gl, source, onLoadCallback) {
                    const texture = gl.createTexture();
                    const image = new Image();
                    image.crossOrigin = "anonymous";
                    image.src = source;

                    image.onload = function () {
                        gl.bindTexture(gl.TEXTURE_2D, texture);
                        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);
                        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);
                        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
                        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
                        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);

                        onLoadCallback(texture); // Call back with the loaded texture
                    };

                    return texture;
                }

                let loadedTextures = {};
                let texturesLoaded = 0;

                function onTextureLoaded(name, tex) {
                    loadedTextures[name] = tex;
                    texturesLoaded++;

                    if (texturesLoaded === 2) {
                        drawScene(); // Only render once both textures are ready
                    }
                }

                textureLoader(gl, "images/one.png", (tex) => onTextureLoaded("front", tex));
                textureLoader(gl, "images/six.png", (tex) => onTextureLoaded("back", tex));
                textureLoader(gl, "images/two.png", (tex) => onTextureLoaded("top", tex));
                textureLoader(gl, "images/five.png", (tex) => onTextureLoaded("bottom", tex));
                textureLoader(gl, "images/three.png", (tex) => onTextureLoaded("right", tex));
                textureLoader(gl, "images/four.png", (tex) => onTextureLoaded("left", tex));

                // For preventing the textures in being rendered in different dice
                function createBlankTexture(gl) {
                    const texture = gl.createTexture();
                    gl.bindTexture(gl.TEXTURE_2D, texture);

                    const blankPixel = new Uint8Array([0, 0, 0, 0]); // Transparent
                    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE, blankPixel);

                    return texture;
                }

                const blankTexture = createBlankTexture(gl);

                var diceSixFaceFront = [
                    -0.25,  0.25,  0.26, 1.0,
                    0.25,  0.25,  0.26, 1.0,
                    -0.25, -0.25,  0.26, 1.0,
                    0.25, -0.25,  0.26, 1.0
                ];

                var diceSixFaceBack = [
                    0.25,  0.25, -0.26, 1.0,
                    -0.25,  0.25, -0.26, 1.0,
                    0.25, -0.25, -0.26, 1.0,
                    -0.25, -0.25, -0.26, 1.0
                ]

                var diceSixFaceTop = [
                    -0.25,  0.26,  0.25, 1.0,
                    -0.25,  0.26, -0.25, 1.0,
                    0.25,  0.26,  0.25, 1.0,
                    0.25,  0.26, -0.25, 1.0
                ]

                var diceSixFaceBottom = [
                    -0.25, -0.26,  0.25, 1.0,
                    0.25, -0.26,  0.25, 1.0,
                    -0.25, -0.26, -0.25, 1.0,
                    0.25, -0.26, -0.25, 1.0,
                ]

                var diceSixFaceRight = [
                    0.26, -0.25,  0.25, 1.0,
                    0.26,  0.25,  0.25, 1.0,
                    0.26, -0.25, -0.25, 1.0,
                    0.26,  0.25, -0.25, 1.0,
                ]

                var diceSixFaceLeft = [
                    -0.26,  0.25,  0.25, 1.0,
                    -0.26, -0.25,  0.25, 1.0,
                    -0.26,  0.25, -0.25, 1.0,
                    -0.26, -0.25, -0.25, 1.0,
                ]
                

                // Initial Rendering (of D4)
                gl.bindBuffer(gl.ARRAY_BUFFER, diceFourBuffer);
                gl.vertexAttribPointer(aPositionPointer, 4, gl.FLOAT, false, 0, 0);

                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, diceFourIndicesBuffer);
                gl.uniform4f(colorLocation,0.7,0.3,0.3,1.0);
                gl.drawElements(gl.TRIANGLES, diceFourIndices.length, gl.UNSIGNED_BYTE, 0);
                
                // For Rotation
                let rotationSpeed = 0.005;
                let isRotating = true;

                function animate() {

                    if (isRotating) {
                    mat4.rotate(modelMatrix, modelMatrix, rotationSpeed, [1, 0, 0]);
                    gl.uniformMatrix4fv(uModelMatrixPointer, false, modelMatrix);

                    mat4.rotate(modelMatrix, modelMatrix, rotationSpeed, [0, 0, 1]);
                    gl.uniformMatrix4fv(uModelMatrixPointer, false, modelMatrix);
                    }

                    drawScene();
                    requestAnimationFrame(animate);
                }


                function drawScene() {
                    gl.clearColor(0,0,0,1.0);
                    gl.clear(gl.COLOR_BUFFER_BIT);

                    gl.uniformMatrix4fv(uModelMatrixPointer, false, modelMatrix);
                    

                    // === Setup Buffers ===
                    const positionBuffer = gl.createBuffer();
                    const uvBuffer = gl.createBuffer();

                    gl.bindBuffer(gl.ARRAY_BUFFER, uvBuffer);
                    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(diceSixUVFace), gl.STATIC_DRAW);
                    gl.enableVertexAttribArray(aTexCoordPointer);
                    gl.vertexAttribPointer(aTexCoordPointer, 2, gl.FLOAT, false, 0, 0);

                    
                    //draw part
                    if (currentDice == "diceFour") {
                        gl.uniform1i(gl.getUniformLocation(program, "uUseTexture"), false);
                        
                        gl.bindBuffer(gl.ARRAY_BUFFER, diceFourBuffer);
                        gl.vertexAttribPointer(aPositionPointer, 4, gl.FLOAT, false, 0, 0);

                        gl.uniform4f(colorLocation,0.7,0.3,0.3,1.0);
                        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, diceFourIndicesBuffer);
                        gl.drawElements(gl.TRIANGLES, diceFourIndices.length, gl.UNSIGNED_BYTE, 0);

                        gl.uniform4f(colorLocation,1.0,1.0,1.0,1.0);
                        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, diceFourEdgesBuffer);
                        gl.drawElements(gl.LINES, diceFourEdges.length, gl.UNSIGNED_BYTE, 0);

                        gl.activeTexture(gl.TEXTURE0);
                        gl.bindTexture(gl.TEXTURE_2D, blankTexture);
                        gl.uniform1i(gl.getUniformLocation(program, "uSampler"), 0);
                        
                    } else if (currentDice == "diceSix") {
                        gl.uniform1i(gl.getUniformLocation(program, "uUseTexture"), false);

                        gl.bindBuffer(gl.ARRAY_BUFFER, diceSixBuffer);
                        gl.vertexAttribPointer(aPositionPointer, 4, gl.FLOAT, false, 0, 0);

                        gl.uniform4f(colorLocation,0.0,0.0,0.0,1.0);
                        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, diceSixIndicesBuffer);
                        gl.drawElements(gl.TRIANGLES, diceSixIndices.length, gl.UNSIGNED_BYTE, 0);

                        gl.uniform4f(colorLocation,1.0,1.0,1.0,1.0);
                        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, diceSixEdgesBuffer);
                        gl.drawElements(gl.LINES, diceSixEdges.length, gl.UNSIGNED_BYTE, 0);

                        // Rendering Texture ==================================================================
                        // === FRONT FACE ===
                        gl.uniform1i(gl.getUniformLocation(program, "uUseTexture"), true);

                        gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
                        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(diceSixFaceFront), gl.STATIC_DRAW);
                        gl.enableVertexAttribArray(aPositionPointer);
                        gl.vertexAttribPointer(aPositionPointer, 4, gl.FLOAT, false, 0, 0);

                        gl.activeTexture(gl.TEXTURE0);
                        gl.bindTexture(gl.TEXTURE_2D, loadedTextures["front"]);
                        gl.uniform1i(gl.getUniformLocation(program, "uSampler"), 0);

                        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);

                        // === BACK FACE ===
                        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(diceSixFaceBack), gl.STATIC_DRAW);

                        gl.activeTexture(gl.TEXTURE0);
                        gl.bindTexture(gl.TEXTURE_2D, loadedTextures["back"]);
                        gl.uniform1i(gl.getUniformLocation(program, "uSampler"), 0);

                        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);

                        // === TOP FACE ===
                        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(diceSixFaceTop), gl.STATIC_DRAW);

                        gl.activeTexture(gl.TEXTURE0);
                        gl.bindTexture(gl.TEXTURE_2D, loadedTextures["top"]);
                        gl.uniform1i(gl.getUniformLocation(program, "uSampler"), 0);

                        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);

                        // === BOTTOM FACE ===
                        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(diceSixFaceBottom), gl.STATIC_DRAW);

                        gl.activeTexture(gl.TEXTURE0);
                        gl.bindTexture(gl.TEXTURE_2D, loadedTextures["bottom"]);
                        gl.uniform1i(gl.getUniformLocation(program, "uSampler"), 0);
                        
                        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
                        
                        // === RIGHT FACE ===
                        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(diceSixFaceRight), gl.STATIC_DRAW);

                        gl.activeTexture(gl.TEXTURE0);
                        gl.bindTexture(gl.TEXTURE_2D, loadedTextures["right"]);
                        gl.uniform1i(gl.getUniformLocation(program, "uSampler"), 0);
                        
                        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);

                        // === LEFT FACE ===
                        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(diceSixFaceLeft), gl.STATIC_DRAW);

                        gl.activeTexture(gl.TEXTURE0);
                        gl.bindTexture(gl.TEXTURE_2D, loadedTextures["left"]);
                        gl.uniform1i(gl.getUniformLocation(program, "uSampler"), 0);
                        
                        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
                        
                    } else if (currentDice == "diceEight") {
                        gl.uniform1i(gl.getUniformLocation(program, "uUseTexture"), false);

                        gl.bindBuffer(gl.ARRAY_BUFFER, diceEightBuffer);
                        gl.vertexAttribPointer(aPositionPointer, 4, gl.FLOAT, false, 0, 0);

                        gl.uniform4f(colorLocation,0.3,0.3,0.7,1.0);
                        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, diceEightIndicesBuffer);
                        gl.drawElements(gl.TRIANGLES, diceEightIndices.length, gl.UNSIGNED_BYTE, 0);

                        gl.uniform4f(colorLocation,1.0,1.0,1.0,1.0);
                        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, diceEightEdgesBuffer);
                        gl.drawElements(gl.LINES, diceEightEdges.length, gl.UNSIGNED_BYTE, 0);

                        gl.activeTexture(gl.TEXTURE0);
                        gl.bindTexture(gl.TEXTURE_2D, blankTexture);
                        gl.uniform1i(gl.getUniformLocation(program, "uSampler"), 0);

                    } else if (currentDice== "diceTwelve") {
                        gl.uniform1i(gl.getUniformLocation(program, "uUseTexture"), false);

                        gl.bindBuffer(gl.ARRAY_BUFFER, diceTwelveBuffer);
                        gl.vertexAttribPointer(aPositionPointer, 3, gl.FLOAT, false, 0, 0);

                        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, diceTwelveIndicesBuffer);
                        gl.uniform4f(colorLocation,0.3,0.3,0.7,1.0);
                        gl.drawElements(gl.TRIANGLES, diceTwelveIndices.length, gl.UNSIGNED_BYTE, 0);

                        gl.uniform4f(colorLocation,1.0,1.0,1.0,1.0);
                        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, diceTwelveEdgesBuffer);
                        gl.drawElements(gl.LINES, diceTwelveEdges.length, gl.UNSIGNED_BYTE, 0);

                        gl.activeTexture(gl.TEXTURE0);
                        gl.bindTexture(gl.TEXTURE_2D, blankTexture);
                        gl.uniform1i(gl.getUniformLocation(program, "uSampler"), 0);
                    }

                }
                                        
                function changeDice(dice) {
                    currentDice = dice;
                }

                document.getElementById("diceFourBtn").addEventListener("click", () => changeDice("diceFour"));
                document.getElementById("diceSixBtn").addEventListener("click", () => changeDice("diceSix"));
                document.getElementById("diceEightBtn").addEventListener("click", () => changeDice("diceEight"));
                document.getElementById("diceTwelveBtn").addEventListener("click", () => changeDice("diceTwelve"));

                drawScene();
                animate();
            }
            
        </script>
    </head>

    <body onload="main()">
        <canvas id="main_canvas" width="1500" height="700" style="border: 1px black solid;"></canvas>
        <button id="diceFourBtn" style="position: absolute; top: 50px; left: 650px; z-index: 1;">D4</button>
        <button id="diceSixBtn" style="position: absolute; top: 50px; left: 700px; z-index: 1;">D6</button>
        <button id="diceEightBtn" style="position: absolute; top: 50px; left: 775px; z-index: 1;">D8</button>
        <button id="diceTwelveBtn" style="position: absolute; top: 50px; left: 825px; z-index: 1;">D12</button>
    </body>
</html>